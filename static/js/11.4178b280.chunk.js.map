{"version":3,"sources":["assets/selfie.glb","pages/Home/Selfie.js"],"names":["module","exports","Selfie","className","delay","alt","rest","colorWhite","themeId","rgbBackgroundLight","useTheme","container","useRef","canvas","renderer","camera","scene","lights","prefersReducedMotion","usePrefersReducedMotion","isInViewport","useInViewport","useEffect","clientWidth","clientHeight","current","WebGLRenderer","powerPreference","setPixelRatio","renderPixelRatio","setSize","outputEncoding","sRGBEncoding","physicallyCorrectLights","PerspectiveCamera","position","z","Scene","GLTFLoader","load","selfieModelPath","model","traverse","node","isMesh","material","shading","SmoothShading","geometry","computeVertexNormals","add","y","cleanScene","cleanRenderer","ambientLight","AmbientLight","dirLight","DirectionalLight","set","background","rgbToThreeColor","forEach","light","removeLights","handleResize","aspect","updateProjectionMatrix","render","window","addEventListener","removeEventListener","rotationSpring","rotationSpringValue","onMouseMove","event","rotation","innerWidth","innerHeight","clientX","clientY","value","x","spring","from","get","to","stiffness","damping","velocity","getVelocity","restSpeed","mass","start","stop","animation","animate","requestAnimationFrame","cancelAnimationFrame","classNames","ref","style","role","aria-label","aria-hidden"],"mappings":"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","file":"static/js/11.4178b280.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/selfie.8ec45f3c.glb\";","import React, { useRef, useEffect } from 'react';\r\nimport classNames from 'classnames';\r\nimport {\r\n  WebGLRenderer,\r\n  sRGBEncoding,\r\n  Scene,\r\n  PerspectiveCamera,\r\n  SmoothShading,\r\n  AmbientLight,\r\n  DirectionalLight,\r\n} from 'three';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { spring, value } from 'popmotion';\r\nimport { usePrefersReducedMotion, useInViewport } from 'hooks';\r\nimport { renderPixelRatio, cleanScene, cleanRenderer, removeLights } from 'utils/three';\r\nimport { rgbToThreeColor } from 'utils/style';\r\nimport { useTheme } from 'components/ThemeProvider';\r\nimport selfieModelPath from 'assets/selfie.glb';\r\nimport './Selfie.css';\r\n\r\nconst Selfie = ({ className, delay, alt, ...rest }) => {\r\n  const { colorWhite, themeId, rgbBackgroundLight } = useTheme();\r\n  const container = useRef();\r\n  const canvas = useRef();\r\n  const renderer = useRef();\r\n  const camera = useRef();\r\n  const scene = useRef();\r\n  const lights = useRef();\r\n  const prefersReducedMotion = usePrefersReducedMotion();\r\n  const isInViewport = useInViewport(canvas);\r\n\r\n  // Init scene and models\r\n  useEffect(() => {\r\n    const { clientWidth, clientHeight } = container.current;\r\n\r\n    renderer.current = new WebGLRenderer({\r\n      canvas: canvas.current,\r\n      powerPreference: 'high-performance',\r\n    });\r\n\r\n    renderer.current.setPixelRatio(renderPixelRatio);\r\n    renderer.current.setSize(clientWidth, clientHeight);\r\n    renderer.current.outputEncoding = sRGBEncoding;\r\n    renderer.current.physicallyCorrectLights = true;\r\n\r\n    camera.current = new PerspectiveCamera(45, clientWidth / clientHeight, 0.1, 800);\r\n    camera.current.position.z = 24;\r\n\r\n    scene.current = new Scene();\r\n\r\n    const modelLoader = new GLTFLoader();\r\n\r\n    modelLoader.load(selfieModelPath, model => {\r\n      model.scene.traverse(node => {\r\n        if (node.isMesh) {\r\n          node.material.shading = SmoothShading;\r\n          node.geometry.computeVertexNormals(true);\r\n        }\r\n      });\r\n\r\n      scene.current.add(model.scene);\r\n      model.scene.position.y = -8;\r\n    });\r\n\r\n    return () => {\r\n      cleanScene(scene.current);\r\n      cleanRenderer(renderer.current);\r\n    };\r\n  }, []);\r\n\r\n  // Lights\r\n  useEffect(() => {\r\n    const ambientLight = new AmbientLight(colorWhite, 0.8);\r\n    const dirLight = new DirectionalLight(colorWhite, themeId === 'light' ? 1.6 : 0.8);\r\n\r\n    dirLight.position.set(30, 20, 32);\r\n\r\n    lights.current = [ambientLight, dirLight];\r\n    scene.current.background = rgbToThreeColor(rgbBackgroundLight);\r\n    lights.current.forEach(light => scene.current.add(light));\r\n\r\n    return () => {\r\n      removeLights(lights.current);\r\n    };\r\n  }, [colorWhite, themeId, rgbBackgroundLight]);\r\n\r\n  // Handles window resize\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      const { clientWidth, clientHeight } = container.current;\r\n\r\n      renderer.current.setSize(clientWidth, clientHeight);\r\n      camera.current.aspect = clientWidth / clientHeight;\r\n      camera.current.updateProjectionMatrix();\r\n\r\n      if (prefersReducedMotion) {\r\n        renderer.current.render(scene.current, camera.current);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    handleResize();\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize);\r\n    };\r\n  }, [prefersReducedMotion]);\r\n\r\n  // Handle mouse move animation\r\n  useEffect(() => {\r\n    let rotationSpring;\r\n    let rotationSpringValue;\r\n\r\n    const onMouseMove = event => {\r\n      const { rotation } = scene.current;\r\n      const { innerWidth, innerHeight } = window;\r\n\r\n      const position = {\r\n        x: (event.clientX - innerWidth / 2) / innerWidth,\r\n        y: (event.clientY - innerHeight / 2) / innerHeight,\r\n      };\r\n\r\n      if (!rotationSpringValue) {\r\n        rotationSpringValue = value({ x: rotation.x, y: rotation.y }, ({ x, y }) => {\r\n          rotation.set(x, y, rotation.z);\r\n        });\r\n      }\r\n\r\n      rotationSpring = spring({\r\n        from: rotationSpringValue.get(),\r\n        to: { x: position.y / 2, y: position.x / 2 },\r\n        stiffness: 40,\r\n        damping: 40,\r\n        velocity: rotationSpringValue.getVelocity(),\r\n        restSpeed: 0.00001,\r\n        mass: 1.4,\r\n      }).start(rotationSpringValue);\r\n    };\r\n\r\n    if (isInViewport && !prefersReducedMotion) {\r\n      window.addEventListener('mousemove', onMouseMove);\r\n    }\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n\r\n      if (rotationSpring) {\r\n        rotationSpring.stop();\r\n      }\r\n    };\r\n  }, [isInViewport, prefersReducedMotion]);\r\n\r\n  // Handles renders\r\n  useEffect(() => {\r\n    let animation;\r\n\r\n    const animate = () => {\r\n      animation = requestAnimationFrame(animate);\r\n\r\n      renderer.current.render(scene.current, camera.current);\r\n    };\r\n\r\n    if (!prefersReducedMotion && isInViewport) {\r\n      animate();\r\n    } else {\r\n      renderer.current.render(scene.current, camera.current);\r\n    }\r\n\r\n    return () => {\r\n      cancelAnimationFrame(animation);\r\n    };\r\n  }, [isInViewport, prefersReducedMotion]);\r\n\r\n  return (\r\n    <div\r\n      className={classNames('selfie', className)}\r\n      ref={container}\r\n      style={{ '--delay': delay }}\r\n      role=\"img\"\r\n      aria-label={alt}\r\n      {...rest}\r\n    >\r\n      <canvas aria-hidden className=\"selfie__canvas\" ref={canvas} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Selfie;\r\n"],"sourceRoot":""}